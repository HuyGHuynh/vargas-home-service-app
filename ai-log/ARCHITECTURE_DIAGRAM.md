# Vargas Home Service - 3-Tier Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT / BROWSER                                 â”‚
â”‚                  (Users: Admin, Employee, Customer)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTP Requests
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PRESENTATION LAYER (Routes)                         â”‚
â”‚                         Flask Blueprints                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   page_bp       â”‚  â”‚  workorder_bp    â”‚  â”‚   warranty_bp       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Frontend Pages  â”‚  â”‚ Workorder API    â”‚  â”‚ Warranty API        â”‚   â”‚
â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚                     â”‚   â”‚
â”‚  â”‚ GET /           â”‚  â”‚ POST /workorders â”‚  â”‚ POST /api/warranty/ â”‚   â”‚
â”‚  â”‚ GET /login      â”‚  â”‚ GET /workorders  â”‚  â”‚      lookup         â”‚   â”‚
â”‚  â”‚ GET /admin/*    â”‚  â”‚ GET /workorders/ â”‚  â”‚ POST /api/warranty/ â”‚   â”‚
â”‚  â”‚ GET /employee/* â”‚  â”‚     <id>         â”‚  â”‚      request-*      â”‚   â”‚
â”‚  â”‚ GET /customer/* â”‚  â”‚                  â”‚  â”‚                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                    â”‚                        â”‚              â”‚
â”‚           â”‚                    â”‚                        â”‚              â”‚
â”‚           â”‚ render_template()  â”‚ WorkorderService       â”‚ WarrantyService
â”‚           â”‚                    â”‚                        â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                        â”‚
            â”‚                    â–¼                        â–¼
            â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         â”‚       BUSINESS LOGIC LAYER (Services)        â”‚
            â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚         â”‚                                              â”‚
            â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
            â”‚         â”‚  â”‚ WorkorderService â”‚  â”‚ WarrantyService â”‚ â”‚
            â”‚         â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
            â”‚         â”‚  â”‚ â€¢ Validation     â”‚  â”‚ â€¢ Validation    â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ parse_date()   â”‚  â”‚ â€¢ Lookup logic  â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ parse_bool()   â”‚  â”‚ â€¢ Service req.  â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ create_work... â”‚  â”‚ â€¢ Email logic   â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ list_work...   â”‚  â”‚                 â”‚ â”‚
            â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
            â”‚         â”‚           â”‚                     â”‚          â”‚
            â”‚         â”‚           â”‚ Repository calls    â”‚          â”‚
            â”‚         â”‚           â”‚                     â”‚          â”‚
            â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
            â”‚                     â–¼                     â–¼
            â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         â”‚       DATA ACCESS LAYER (Repositories)       â”‚
            â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚         â”‚                                              â”‚
            â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
            â”‚         â”‚  â”‚ WorkorderRepo    â”‚  â”‚ WarrantyRepo    â”‚ â”‚
            â”‚         â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
            â”‚         â”‚  â”‚ â€¢ create()       â”‚  â”‚ â€¢ lookup_by_*() â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ list_all()     â”‚  â”‚ â€¢ get_by_id()   â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ get_by_id()    â”‚  â”‚ â€¢ create_srv... â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ update()       â”‚  â”‚                 â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ delete()       â”‚  â”‚                 â”‚ â”‚
            â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
            â”‚         â”‚           â”‚                     â”‚          â”‚
            â”‚         â”‚           â”‚  Raw SQL Queries    â”‚          â”‚
            â”‚         â”‚           â”‚                     â”‚          â”‚
            â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
            â”‚         â”‚  â”‚       BaseRepository                  â”‚ â”‚
            â”‚         â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
            â”‚         â”‚  â”‚ â€¢ get_db_connection()                 â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ get_cursor() context manager        â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ get_dict_cursor()                   â”‚ â”‚
            â”‚         â”‚  â”‚ â€¢ Auto commit/rollback                â”‚ â”‚
            â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
            â”‚         â”‚                  â”‚                         â”‚
            â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                            â”‚
            â”‚                            â”‚ psycopg2
            â”‚                            â–¼
            â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                  â”‚   PostgreSQL DB     â”‚
            â”‚                  â”‚                     â”‚
            â”‚                  â”‚ Tables:             â”‚
            â”‚                  â”‚ â€¢ workorders        â”‚
            â”‚                  â”‚ â€¢ warranties        â”‚
            â”‚                  â”‚ â€¢ service_requests  â”‚
            â”‚                  â”‚ â€¢ user              â”‚
            â”‚                  â”‚ â€¢ ...               â”‚
            â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Static Files          â”‚
  â”‚   (CSS, JS, Images)     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ server/static/          â”‚
  â”‚ â”œâ”€â”€ css/                â”‚
  â”‚ â”‚   â”œâ”€â”€ adminEmployee   â”‚
  â”‚ â”‚   â”œâ”€â”€ warranty        â”‚
  â”‚ â”‚   â””â”€â”€ ... (14 files)  â”‚
  â”‚ â””â”€â”€ js/                 â”‚
  â”‚     â”œâ”€â”€ adminEmployee   â”‚
  â”‚     â”œâ”€â”€ warranty        â”‚
  â”‚     â””â”€â”€ ... (14 files)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONFIGURATION & UTILITIES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  config.py              __init__.py (App Factory)      main.py          â”‚
â”‚  â”œâ”€â”€ Config            â”œâ”€â”€ create_app()               â””â”€â”€ Entry point  â”‚
â”‚  â”œâ”€â”€ DevelopmentConfig â””â”€â”€ Register blueprints                          â”‚
â”‚  â”œâ”€â”€ ProductionConfig                                                   â”‚
â”‚  â””â”€â”€ get_config()                                                       â”‚
â”‚                                                                          â”‚
â”‚  Environment Variables (.env):                                          â”‚
â”‚  â€¢ DATABASE_URL                                                         â”‚
â”‚  â€¢ SECRET_KEY                                                           â”‚
â”‚  â€¢ FLASK_ENV                                                            â”‚
â”‚  â€¢ FLASK_DEBUG                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          DATA FLOW EXAMPLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Example 1: User accesses home page
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Browser â†’ GET / 
         â†’ page_bp.home() 
         â†’ render_template("home.html") 
         â†’ Returns HTML with CSS/JS links
         â†’ Browser requests /static/css/home.css
         â†’ Flask serves static file

Example 2: Create workorder via API
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Browser â†’ POST /workorders {data}
         â†’ workorder_bp.create_workorder()
         â†’ WorkorderService.create_workorder(data)
              â”œâ”€â”€ Validates data
              â”œâ”€â”€ Parses date/bool
              â””â”€â”€ WorkorderRepository.create(...)
                   â””â”€â”€ Raw SQL INSERT
                        â””â”€â”€ PostgreSQL
         â† Returns JSON response {"ok": true, "workorderId": 123}

Example 3: Lookup warranty
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Browser â†’ POST /api/warranty/lookup {email: "..."}
         â†’ warranty_bp.lookup_warranty()
         â†’ WarrantyService.lookup_warranty(data)
              â”œâ”€â”€ Validates input
              â””â”€â”€ WarrantyRepository.lookup_by_email_or_phone(...)
                   â””â”€â”€ Raw SQL SELECT with JOIN
                        â””â”€â”€ PostgreSQL
         â† Returns JSON {"success": true, "warranties": [...]}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Key Architecture Principles

### ğŸ¯ Separation of Concerns
- **Routes**: Handle HTTP only
- **Services**: Business logic only
- **Repositories**: Database access only

### ğŸ”„ Request Flow
1. Client â†’ Route (validates HTTP)
2. Route â†’ Service (applies business logic)
3. Service â†’ Repository (executes SQL)
4. Repository â†’ Database
5. Database â†’ Repository â†’ Service â†’ Route â†’ Client

### ğŸ“¦ Modularity
- Each component is independent
- Easy to test, maintain, and extend
- Can swap implementations without affecting other layers

### ğŸ›¡ï¸ Error Handling
- Repositories: Catch DB errors
- Services: Handle business rule violations
- Routes: Format error responses for HTTP

### ğŸ”§ Configuration
- Environment-based (dev, prod, test)
- Centralized in `config.py`
- Loaded from `.env` file
